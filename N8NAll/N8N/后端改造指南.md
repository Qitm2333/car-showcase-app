# ğŸ”§ æ”¶è—å¤¹åç«¯æ”¹é€ æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•å°† Demo çš„ N8N å·¥ä½œæµé€‚é…åˆ°æˆ‘ä»¬çš„é¡¹ç›®ã€‚

---

## ğŸ¯ æ ¸å¿ƒæ”¹åŠ¨

### **1. å­—æ®µæ˜ å°„**
| Demo å­—æ®µ | æˆ‘ä»¬çš„å­—æ®µ | è¯´æ˜ |
|-----------|-----------|------|
| `userID` | `inviteCode` | ç”¨æˆ·æ ‡è¯†ï¼Œå‰ç«¯ä¼  inviteCode çš„å€¼ |
| æ—  | `category` | å›¾ç‰‡åˆ†ç±»ï¼ˆå¤–è§‚/å†…é¥°ï¼‰ |
| æ—  | `viewType` | å›¾ç‰‡è§†è§’ï¼ˆæ­£45/ä¾§é¢ï¼‰ |

### **2. è¡¨æ ¼ç»“æ„**

#### **FavoriteFolders è¡¨ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰**
```
A: folderID      - æ”¶è—å¤¹ID
B: userID        - ç”¨æˆ·IDï¼ˆå­˜å‚¨ inviteCodeï¼‰
C: folderName    - æ”¶è—å¤¹åç§°
D: folderIcon    - æ”¶è—å¤¹å›¾æ ‡
E: createTime    - åˆ›å»ºæ—¶é—´
F: status        - çŠ¶æ€ï¼ˆactive/deletedï¼‰
```

#### **Favorites è¡¨ï¼ˆéœ€æ·»åŠ  2 åˆ—ï¼‰**
```
A: favoriteID    - æ”¶è—é¡¹ID
B: userID        - ç”¨æˆ·IDï¼ˆå­˜å‚¨ inviteCodeï¼‰
C: folderID      - æ‰€å±æ”¶è—å¤¹ID
D: carID         - è½¦è¾†ID
E: carName       - è½¦å‹åç§°
F: imageURL      - å›¾ç‰‡URL
G: category      - ğŸ†• åˆ†ç±»ï¼ˆå¤–è§‚/å†…é¥°/ç»†èŠ‚ï¼‰
H: viewType      - ğŸ†• è§†è§’ï¼ˆæ­£45/ä¾§45/ä¾§é¢/æ­£é¢/èƒŒé¢ï¼‰
I: favoriteTime  - æ”¶è—æ—¶é—´
J: status        - çŠ¶æ€ï¼ˆactive/deletedï¼‰
```

---

## ğŸ› ï¸ ä¿®æ”¹æ­¥éª¤

### **æ­¥éª¤ 1ï¼šä¿®æ”¹ Google Sheets**

1. æ‰“å¼€ä½ çš„ Google Sheets
2. æ‰¾åˆ° **Favorites** è¡¨
3. åœ¨ **Fåˆ—ï¼ˆimageURLï¼‰åé¢** æ’å…¥ä¸¤åˆ—ï¼š
   - **Gåˆ—**ï¼š`category`
   - **Håˆ—**ï¼š`viewType`
4. ä¿å­˜

---

### **æ­¥éª¤ 2ï¼šä¿®æ”¹ N8N å·¥ä½œæµ**

æ‰“å¼€ N8Nï¼Œæ‰¾åˆ° Demo å¯¼å…¥çš„å·¥ä½œæµï¼Œä¿®æ”¹ä»¥ä¸‹ 3 ä¸ªèŠ‚ç‚¹ï¼š

#### **èŠ‚ç‚¹ 1ï¼š`å¤„ç†å‚æ•°`ï¼ˆCode èŠ‚ç‚¹ï¼‰**

æ‰¾åˆ° `action === 'add'` è¿™æ®µä»£ç ï¼š

**åŸä»£ç **ï¼š
```javascript
if (action === 'add') {
  const { carID, carName, imageURL, folderID } = body;
  
  // ...
  
  return {
    json: {
      action: 'add',
      favoriteID: favoriteID,
      userID: userID,
      folderID: folderID || '',
      carID: carID,
      carName: carName,
      imageURL: imageURL,
      favoriteTime: new Date().toISOString(),
      status: 'active'
    }
  };
}
```

**ä¿®æ”¹ä¸º**ï¼š
```javascript
if (action === 'add') {
  const { carID, carName, imageURL, folderID, category, viewType } = body;  // æ·»åŠ  category, viewType
  
  // ...
  
  return {
    json: {
      action: 'add',
      favoriteID: favoriteID,
      userID: userID,
      folderID: folderID || '',
      carID: carID,
      carName: carName,
      imageURL: imageURL,
      category: category || '',        // ğŸ†• æ–°å¢
      viewType: viewType || '',        // ğŸ†• æ–°å¢
      favoriteTime: new Date().toISOString(),
      status: 'active'
    }
  };
}
```

---

#### **èŠ‚ç‚¹ 2ï¼š`ä¿å­˜æ”¶è—`ï¼ˆGoogle Sheets èŠ‚ç‚¹ï¼‰**

1. æ‰“å¼€èŠ‚ç‚¹é…ç½®
2. æ‰¾åˆ° **Columns to Send** é…ç½®
3. æ·»åŠ ä¸¤ä¸ªå­—æ®µæ˜ å°„ï¼š

```
category:  {{ $json.category }}
viewType:  {{ $json.viewType }}
```

**å®Œæ•´é…ç½®**ï¼š
```json
{
  "favoriteID": "={{ $json.favoriteID }}",
  "userID": "={{ $json.userID }}",
  "folderID": "={{ $json.folderID }}",
  "carID": "={{ $json.carID }}",
  "carName": "={{ $json.carName }}",
  "imageURL": "={{ $json.imageURL }}",
  "category": "={{ $json.category }}",      // ğŸ†•
  "viewType": "={{ $json.viewType }}",      // ğŸ†•
  "favoriteTime": "={{ $json.favoriteTime }}",
  "status": "={{ $json.status }}"
}
```

---

#### **èŠ‚ç‚¹ 3ï¼š`æ”¶è—åˆ—è¡¨å“åº”`ï¼ˆCode èŠ‚ç‚¹ï¼‰**

æ‰¾åˆ° `map` å‡½æ•°ï¼š

**åŸä»£ç **ï¼š
```javascript
const favorites = filteredItems.map(item => ({
  favoriteID: item.json.favoriteID || '',
  folderID: item.json.folderID || '',
  carID: item.json.carID || '',
  carName: item.json.carName || '',
  imageURL: item.json.imageURL || '',
  favoriteTime: item.json.favoriteTime || ''
}));
```

**ä¿®æ”¹ä¸º**ï¼š
```javascript
const favorites = filteredItems.map(item => ({
  favoriteID: item.json.favoriteID || '',
  folderID: item.json.folderID || '',
  carID: item.json.carID || '',
  carName: item.json.carName || '',
  imageURL: item.json.imageURL || '',
  category: item.json.category || '',        // ğŸ†•
  viewType: item.json.viewType || '',        // ğŸ†•
  favoriteTime: item.json.favoriteTime || ''
}));
```

---

### **æ­¥éª¤ 3ï¼šæµ‹è¯• API**

ä½¿ç”¨ Postman æˆ– curl æµ‹è¯•æ¯ä¸ªæ“ä½œï¼š

#### **1. åˆ›å»ºæ”¶è—å¤¹**
```bash
POST https://your-n8n-url/webhook/user-favorite
Content-Type: application/json

{
  "action": "createFolder",
  "userID": "TEST001",
  "folderName": "æˆ‘çš„å¤–è§‚æ”¶è—",
  "folderIcon": "ğŸš—"
}
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "success": true,
  "message": "æ”¶è—å¤¹åˆ›å»ºæˆåŠŸ",
  "data": {
    "folderID": "folder_20241031_abc123",
    "folderName": "æˆ‘çš„å¤–è§‚æ”¶è—",
    "folderIcon": "ğŸš—"
  }
}
```

---

#### **2. è·å–æ”¶è—å¤¹åˆ—è¡¨**
```bash
POST https://your-n8n-url/webhook/user-favorite
Content-Type: application/json

{
  "action": "listFolders",
  "userID": "TEST001"
}
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "success": true,
  "message": "æ‰¾åˆ°1ä¸ªæ”¶è—å¤¹",
  "total": 1,
  "folders": [
    {
      "folderID": "folder_20241031_abc123",
      "folderName": "æˆ‘çš„å¤–è§‚æ”¶è—",
      "folderIcon": "ğŸš—",
      "createTime": "2024-10-31T10:00:00Z"
    }
  ]
}
```

---

#### **3. æ·»åŠ æ”¶è—ï¼ˆåŒ…å« category å’Œ viewTypeï¼‰**
```bash
POST https://your-n8n-url/webhook/user-favorite
Content-Type: application/json

{
  "action": "add",
  "userID": "TEST001",
  "folderID": "folder_20241031_abc123",
  "carID": 1,
  "carName": "smartç²¾çµ#5",
  "imageURL": "https://example.com/car-1.jpg",
  "category": "å¤–è§‚",
  "viewType": "æ­£45"
}
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "success": true,
  "message": "æ”¶è—æˆåŠŸ",
  "data": {
    "favoriteID": "fav_20241031_xyz789",
    "carName": "smartç²¾çµ#5",
    "folderID": "folder_20241031_abc123",
    "timestamp": "2024-10-31T10:30:00Z"
  }
}
```

---

#### **4. è·å–æ”¶è—åˆ—è¡¨**
```bash
POST https://your-n8n-url/webhook/user-favorite
Content-Type: application/json

{
  "action": "list",
  "userID": "TEST001",
  "folderID": "folder_20241031_abc123"
}
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "success": true,
  "message": "æ‰¾åˆ°1ä¸ªæ”¶è—",
  "total": 1,
  "favorites": [
    {
      "favoriteID": "fav_20241031_xyz789",
      "folderID": "folder_20241031_abc123",
      "carID": "1",
      "carName": "smartç²¾çµ#5",
      "imageURL": "https://example.com/car-1.jpg",
      "category": "å¤–è§‚",
      "viewType": "æ­£45",
      "favoriteTime": "2024-10-31T10:30:00Z"
    }
  ]
}
```

---

#### **5. åˆ é™¤æ”¶è—**
```bash
POST https://your-n8n-url/webhook/user-favorite
Content-Type: application/json

{
  "action": "delete",
  "userID": "TEST001",
  "favoriteID": "fav_20241031_xyz789"
}
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "success": true,
  "message": "å·²å–æ¶ˆæ”¶è—"
}
```

---

#### **6. åˆ é™¤æ”¶è—å¤¹**
```bash
POST https://your-n8n-url/webhook/user-favorite
Content-Type: application/json

{
  "action": "deleteFolder",
  "userID": "TEST001",
  "folderID": "folder_20241031_abc123"
}
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "success": true,
  "message": "æ”¶è—å¤¹å·²åˆ é™¤"
}
```

---

## âœ… éªŒè¯æ¸…å•

- [ ] Google Sheets çš„ Favorites è¡¨æ·»åŠ äº† `category` å’Œ `viewType` åˆ—
- [ ] N8N çš„ `å¤„ç†å‚æ•°` èŠ‚ç‚¹å·²ä¿®æ”¹ï¼ˆæ·»åŠ  category å’Œ viewTypeï¼‰
- [ ] N8N çš„ `ä¿å­˜æ”¶è—` èŠ‚ç‚¹å·²æ·»åŠ å­—æ®µæ˜ å°„
- [ ] N8N çš„ `æ”¶è—åˆ—è¡¨å“åº”` èŠ‚ç‚¹å·²ä¿®æ”¹è¿”å›å­—æ®µ
- [ ] æµ‹è¯•åˆ›å»ºæ”¶è—å¤¹ âœ…
- [ ] æµ‹è¯•è·å–æ”¶è—å¤¹åˆ—è¡¨ âœ…
- [ ] æµ‹è¯•æ·»åŠ æ”¶è—ï¼ˆåŒ…å« category å’Œ viewTypeï¼‰âœ…
- [ ] æµ‹è¯•è·å–æ”¶è—åˆ—è¡¨ï¼ˆéªŒè¯è¿”å›åŒ…å« category å’Œ viewTypeï¼‰âœ…
- [ ] æµ‹è¯•åˆ é™¤æ”¶è— âœ…
- [ ] æµ‹è¯•åˆ é™¤æ”¶è—å¤¹ âœ…
- [ ] å¤åˆ¶ Webhook URL å¹¶é…ç½®åˆ°å‰ç«¯ âœ…

---

## ğŸ¯ ä¸‹ä¸€æ­¥

å®Œæˆåç«¯é…ç½®åï¼Œä½ å¯ä»¥ï¼š

1. âœ… åœ¨å‰ç«¯ Webhook è°ƒè¯•å™¨ä¸­é…ç½® URL
2. âœ… å¼€å§‹å‰ç«¯åŸºç¡€æ¶æ„å¼€å‘ï¼ˆfavoriteService + FolderCacheContextï¼‰
3. âœ… æ”¹é€  UI ç»„ä»¶ï¼ˆåŠ¨æ€æ¸²æŸ“æ”¶è—å¤¹å¡ç‰‡ï¼‰

---

## ğŸ’¡ å‰ç«¯é€‚é…è¯´æ˜

å‰ç«¯è°ƒç”¨ API æ—¶ï¼Œéœ€è¦å°† `inviteCode` æ˜ å°„ä¸º `userID`ï¼š

```typescript
// âŒ é”™è¯¯
const result = await fetch(API_URL, {
  body: JSON.stringify({ 
    action: 'add',
    inviteCode: inviteCode,  // é”™è¯¯ï¼šåç«¯ä¸è®¤è¯† inviteCode
    ...
  })
});

// âœ… æ­£ç¡®
const result = await fetch(API_URL, {
  body: JSON.stringify({ 
    action: 'add',
    userID: inviteCode,  // æ­£ç¡®ï¼šä½¿ç”¨ userID å­—æ®µï¼Œå€¼æ˜¯ inviteCode
    ...
  })
});
```

**åœ¨ favoriteService.ts ä¸­ç»Ÿä¸€å¤„ç†**ï¼š
```typescript
export async function addToFavorite(data: {
  inviteCode: string;  // å‰ç«¯ä½¿ç”¨ inviteCode
  folderID: string;
  carID: number;
  carName: string;
  imageURL: string;
  category?: string;
  viewType?: string;
}) {
  const response = await fetch(API_ENDPOINTS.USER_FAVORITE, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      action: 'add',
      userID: data.inviteCode,  // æ˜ å°„ï¼šinviteCode â†’ userID
      folderID: data.folderID,
      carID: data.carID,
      carName: data.carName,
      imageURL: data.imageURL,
      category: data.category,
      viewType: data.viewType,
    })
  });
  
  return await response.json();
}
```

---

## ğŸš€ å‡†å¤‡å¥½äº†å—ï¼Ÿ

å®Œæˆè¿™äº›ä¿®æ”¹åï¼Œä½ å°±å¯ä»¥å¼€å§‹å‰ç«¯å¼€å‘äº†ï¼

**éœ€è¦å¸®åŠ©ï¼Ÿ** éšæ—¶é—®æˆ‘ï¼ğŸ˜Š

