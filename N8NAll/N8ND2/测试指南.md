# 🔍 车型筛选功能测试指南

## ✅ 整合完成清单

- [x] N8N筛选API配置 (`src/config/api.ts`)
- [x] 筛选服务层 (`src/services/carFilterService.ts`)
- [x] 中部栏筛选组件更新 (`src/imports/inspiration-main/中部栏.tsx`)
- [x] 主页面逻辑集成 (`src/pages/CarShowcaseMain.tsx`)
- [x] 筛选结果展示组件 (`src/components/FilteredCarGrid.tsx`)
- [x] 保持原有卡片布局样式

---

## 🎯 功能说明

### 工作流程

```
用户选择筛选条件
    ↓
中部栏组件触发 onFilterChange
    ↓
CarShowcaseMain 调用 N8N API
    ↓
N8N 从 Google Sheet 读取数据并筛选
    ↓
返回筛选结果
    ↓
FilteredCarGrid 动态显示车型卡片
```

### 支持的筛选条件

1. **品牌筛选** - 比亚迪、腾势、问界、理想、小鹏、蔚来
2. **车型筛选** - SUV、Sedan、MPV、OffRoad、小型车、其他
3. **视角筛选** - 正侧图、正45°、前脸、门板、IP、CNSL、座椅
4. ~~部件筛选~~ - 暂不支持（前端已实现UI，N8N待扩展）
5. ~~时间筛选~~ - 暂不支持（前端已实现UI，N8N待扩展）

---

## 🧪 测试步骤

### 1️⃣ 激活 N8N 工作流

1. 登录 N8N: https://lynn-cafa-system.app.n8n.cloud
2. 找到工作流：**"根据GoogleSheet筛选"**
3. 导入 `N8ND2/根据GoogleSheet筛选的N8N工作流.json`
4. 确认 Google Sheet 凭证已配置
5. 点击右上角 **"Active"** 激活工作流

### 2️⃣ 启动本地开发服务器

```bash
npm run dev
```

### 3️⃣ 测试筛选功能

#### 测试场景 1: 品牌筛选

1. 打开页面: http://localhost:5173/car-showcase
2. 点击 **"品牌"** 下拉菜单
3. 选择 **"比亚迪"**
4. 观察：
   - ✅ 显示 "正在筛选..." 加载动画
   - ✅ 加载完成后显示比亚迪相关车型
   - ✅ 卡片布局保持原样（绝对定位，3行4列）
   - ✅ 控制台输出筛选日志

#### 测试场景 2: 车型筛选

1. 点击 **"车型"** 下拉菜单
2. 选择 **"SUV"**
3. 观察：
   - ✅ 显示所有SUV车型
   - ✅ 图片正确加载（从Google Sheet的imageURL）
   - ✅ 车名和车型类别正确显示

#### 测试场景 3: 组合筛选

1. 选择品牌：**"比亚迪"**
2. 选择车型：**"Sedan"**
3. 观察：
   - ✅ 只显示比亚迪的轿车（如BYD Seal 06, BYD Han）
   - ✅ 筛选条件同时生效

#### 测试场景 4: 清空筛选

1. 点击 **"全部品牌"**
2. 观察：
   - ✅ 恢复显示默认的12张车卡片
   - ✅ 不再调用N8N API

#### 测试场景 5: 无结果处理

1. 选择一个不存在的组合（如 品牌:问界 + 车型:MPV）
2. 观察：
   - ✅ 显示空结果
   - ✅ 控制台提示 "⚠️ 未找到匹配结果"
   - ✅ 页面显示默认卡片

---

## 🔍 调试工具

### 浏览器控制台日志

筛选过程会输出详细日志：

```javascript
🔍 筛选条件变化: {
  keyword: "",
  brands: ["比亚迪"],
  models: [],
  views: [],
  parts: [],
  times: []
}

✅ 获取到 3 条筛选结果
```

### N8N 工作流日志

在N8N界面查看：
1. 点击工作流节点
2. 查看 "Executions" 标签
3. 查看每个节点的输入输出数据

---

## 🛠️ API 测试（Postman）

### 请求配置

```http
POST https://lynn-cafa-system.app.n8n.cloud/webhook-test/car-image-filter
Content-Type: application/json

{
  "brands": ["比亚迪"],
  "models": ["SUV"],
  "views": []
}
```

### 预期响应

```json
{
  "success": true,
  "count": 2,
  "results": [
    {
      "carName": "BYD Song Plus",
      "vehicleClass": "紧凑型车SUV",
      "viewType": "正侧图",
      "imageURL": "https://example.com/car.jpg"
    }
  ],
  "filters": {
    "brands": ["比亚迪"],
    "models": ["SUV"],
    "views": []
  },
  "timestamp": "2025-01-01T00:00:00.000Z"
}
```

---

## 📊 Google Sheet 数据格式

工作流从 Google Sheet 读取数据，表格应包含以下列：

| 列名 | 说明 | 示例 |
|------|------|------|
| `carName` | 车型名称 | BYD Song Plus |
| `vehicleClass` | 车型类别 | 紧凑型车SUV |
| `viewType` | 视角类型 | 正侧图 |
| `imageURL` | 图片URL | https://... |

---

## ⚠️ 常见问题

### Q1: 点击筛选按钮没有反应？

**检查：**
- N8N工作流是否已激活
- 浏览器控制台是否有错误
- 网络请求是否成功 (F12 → Network → 查找 car-image-filter)

### Q2: 图片不显示？

**检查：**
- Google Sheet 中的 imageURL 是否有效
- 图片URL是否可以公开访问
- 查看控制台的图片加载错误

### Q3: CORS 错误？

**解决：**
- 确认N8N Webhook节点的 "Allowed Origins" 设置为 `*, null`
- 确认 "Respond to Webhook" 节点包含 CORS headers

### Q4: 筛选结果不准确？

**检查：**
- Google Sheet 数据格式是否正确
- N8N工作流中的筛选逻辑（"执行筛选"节点）
- 品牌名称是否包含在 carName 中

---

## 🚀 部署到 Vercel

### 更新并部署

```bash
# 1. 提交更改
git add .
git commit -m "feat: 整合N8N车型筛选功能"

# 2. 推送到GitHub
git push

# 3. Vercel自动部署
# 访问: https://your-app.vercel.app/car-showcase
```

### 生产环境测试

1. 打开 Vercel 部署的网站
2. 重复上述测试场景
3. 确认 N8N API 可以被公网访问

---

## 📝 下一步优化建议

1. **添加部件和时间筛选** - 扩展N8N工作流支持更多筛选维度
2. **关键词搜索** - 实现搜索框的关键词筛选功能
3. **标签筛选** - 将用户输入的标签也作为筛选条件
4. **分页功能** - 当结果超过12个时，支持翻页查看
5. **缓存优化** - 添加本地缓存，减少API调用
6. **错误提示** - 更友好的错误提示UI
7. **图片预加载** - 提升用户体验

---

## ✨ 功能亮点

✅ **实时筛选** - 选择筛选条件后立即触发API调用  
✅ **保持原布局** - 筛选结果完美适配原有的卡片布局  
✅ **数据驱动** - 图片和信息全部来自Google Sheet  
✅ **优雅降级** - API失败时显示默认内容，不影响用户体验  
✅ **加载状态** - 显示加载动画，提升用户感知  
✅ **类型安全** - 完整的TypeScript类型定义  

---

**测试愉快！🎉**

