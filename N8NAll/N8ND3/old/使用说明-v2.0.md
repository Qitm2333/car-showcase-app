# 汽车详情查询系统 v2.0 使用说明

## 🎉 v2.0 新增功能

### 智能标签功能
- AI自动生成3-5个关键标签（如：运动风格、智能驾驶、豪华内饰）
- 标签直观展示车辆核心特点
- 支持自动回退到默认标签（如AI生成失败）

### 优化的AI提示词
- 更加结构化的AI输出格式
- 第一行：智能标签（逗号分隔）
- 第二行开始：50字设计师视角分析

---

## 📦 文件结构

```
N8ND3/
├── car-explorer-v2.html          # v2.0 HTML页面（包含智能标签）
├── 汽车详情工作流-完整版.json      # 更新的N8N工作流
└── 使用说明-v2.0.md               # 本说明文档
```

---

## 🚀 快速开始

### 1. 导入N8N工作流

1. 打开N8N工作流编辑器
2. 点击右上角 **"导入工作流"**
3. 选择 `汽车详情工作流-完整版.json` 文件
4. 确认所有节点连接正确

### 2. 配置必要的凭证

工作流需要以下API凭证：

- **Google Sheets OAuth2** (读取车辆数据)
- **DeepSeek API** (AI分析)
- **Pinecone API** (向量检索，可选)
- **OpenAI API** (嵌入模型，可选)

### 3. 激活工作流

点击右上角 **"激活"** 按钮，工作流将生成webhook URL。

### 4. 使用HTML页面

1. 用浏览器打开 `car-explorer-v2.html`
2. 在配置面板输入你的webhook URL
3. 点击 **"保存配置"**
4. 开始搜索汽车！

---

## 🎨 页面功能

### 🔧 Webhook配置
- 支持自定义webhook地址
- 配置自动保存到浏览器本地存储
- 实时显示配置状态

### 🔍 智能搜索
- 输入车型名称（支持模糊匹配）
- 快捷标签一键搜索
- 回车键快速查询

### 📊 详细信息展示

#### 主图区域
- 显示车辆45度角外观图
- 收藏按钮（点击交互）

#### AI分析面板
- **🏷️ 智能标签**：AI自动生成的3-5个关键特点
- **AI分析**：资深设计师视角的50字简评
- **车型分类**：自动提取（如Sedan、SUV）
- **价格区间**：实时显示官方指导价
- **官网链接**：一键跳转汽车之家详情页
- **相关车型**：同级别、相似价位的推荐车型

#### 详细图片
- 网格布局展示所有车辆图片
- 图片分类标签（外观/内饰/细节）
- 点击大图查看

---

## 🔧 工作流节点说明

### 核心节点流程

```
接收请求 → 解析参数 → 读取GoogleSheet → 处理所有逻辑 
   ↓
AI智能体 (DeepSeek + Pinecone) → 整合最终结果 → 返回结果
```

### 关键节点详解

#### 1. 接收请求 (Webhook)
- **路径**: `/webhook/car-detail-complete`
- **方法**: POST
- **CORS**: 已启用

#### 2. 解析参数 (Code)
- 提取 `carName` 参数
- 验证输入有效性

#### 3. 读取GoogleSheet
- 数据源: `CarImageURLMVP用`
- 包含字段: carID, carName, carPriceRange, vehicleClass, imageURL等

#### 4. 处理所有逻辑 (Code) ⭐️ v2.0更新
- **模糊匹配**: 智能匹配车型名称（支持空格、连字符变化）
- **主图筛选**: 优先选择view45外观图
- **相关车型**: 基于车型分类和价格推荐
- **AI提示词生成**: 
  ```
  第一行：输出3-5个关键标签（用逗号分隔）
  第二行开始：以资深设计师的角度，用50字简短分析车型的设计美学与品牌背景。
  ```

#### 5. AI智能体
- **模型**: DeepSeek Chat Model
- **增强**: Pinecone向量检索
- **输出**: 结构化的标签+分析内容

#### 6. 整合最终结果 (Code) ⭐️ v2.0新增
- **智能标签提取**: 从AI输出第一行提取标签
- **内容分离**: 将标签和分析内容分开
- **回退机制**: 如果AI失败，提供默认标签
- **输出格式**:
  ```json
  {
    "success": true,
    "data": {
      "carName": "比亚迪海豹",
      "carPriceRange": "21.28-28.98万",
      "vehicleClass": "中型车Sedan",
      "mainImageUrl": "https://...",
      "aiAnalysis": "设计师分析内容...",
      "smartTags": ["运动风格", "智能驾驶", "豪华内饰"],
      "relatedCars": [...],
      "detailImages": [...],
      "stats": {...}
    }
  }
  ```

---

## 🎯 使用示例

### 示例1：搜索 "比亚迪海豹"

**输入**: `比亚迪海豹`

**返回数据**:
```json
{
  "success": true,
  "data": {
    "carName": "比亚迪-海豹",
    "carPriceRange": "21.28-28.98万",
    "vehicleClass": "中型车Sedan",
    "smartTags": ["海洋美学", "运动轿跑", "电动性能"],
    "aiAnalysis": "比亚迪海豹传承海洋美学设计语言，以流线型车身展现运动轿跑姿态...",
    "relatedCars": [
      { "carName": "小鹏P7", "carPriceRange": "20.99-33.99万" },
      ...
    ]
  }
}
```

### 示例2：点击相关车型

用户点击"小鹏P7"卡片 → 自动重新搜索 → 展示小鹏P7详情

---

## 🔍 智能标签提取逻辑

### AI输出格式
```
运动风格,智能驾驶,豪华内饰,高性价比
比亚迪海豹传承海洋美学设计语言，以流线型车身展现运动轿跑姿态，融合电动性能与智能科技...
```

### 提取过程
1. 按换行符分割AI输出
2. 第一行按逗号/顿号分割为标签数组
3. 剩余行合并为分析内容
4. 如果提取失败，使用默认标签：`['品质之选', '设计美学', '智能科技']`

---

## 📱 响应式设计

- **桌面端**: 双栏布局（主图 + AI分析）
- **平板**: 自适应单栏
- **移动端**: 全屏单栏 + 优化触控

---

## 🛠️ 故障排查

### 问题1：未找到车型
**原因**: 车型名称不匹配  
**解决**: 使用模糊搜索，如输入"海豹"代替"比亚迪-海豹"

### 问题2：AI分析显示"暂无AI分析"
**原因**: AI节点失败或超时  
**解决**: 
- 检查DeepSeek API凭证
- 查看N8N工作流执行日志
- AI节点已设置 `onError: continueRegularOutput`，不会阻塞流程

### 问题3：智能标签显示"品质之选、设计美学、智能科技"
**原因**: AI输出格式不正确或提取失败  
**解决**: 
- 这是正常的回退机制
- 检查AI提示词是否正确
- 查看"整合最终结果"节点的console日志

### 问题4：CORS错误
**原因**: Webhook跨域配置问题  
**解决**: 确认"返回结果"节点的CORS头已正确配置

---

## 🎨 自定义修改

### 修改快捷标签
在 `car-explorer-v2.html` 中找到:
```html
<span class="hot-tag" onclick="quickSearch('比亚迪海豹')">比亚迪海豹</span>
```
修改为你想要的车型。

### 修改AI提示词
在 `汽车详情工作流-完整版.json` 的"处理所有逻辑"节点中修改 `chatinput`:
```javascript
chatinput: `第一行：输出3-5个关键标签（用逗号分隔）
第二行开始：[你的自定义提示词]`
```

### 修改默认标签
在"整合最终结果"节点中找到:
```javascript
if (smartTags.length === 0) {
  smartTags = ['品质之选', '设计美学', '智能科技'];
}
```
修改为你的默认标签。

---

## 📊 数据结构说明

### Google Sheet 字段
- `carID`: 汽车唯一ID
- `carName`: 车型名称（如"比亚迪-海豹"）
- `carPriceRange`: 价格区间（如"21.28-28.98万"）
- `vehicleClass`: 车型分类（如"中型车Sedan"）
- `brandID`: 品牌ID
- `imageURL`: 图片URL
- `viewType`: 视角类型（view45, front, side等）
- `category`: 图片分类（外观、内饰、细节）

---

## 📝 更新日志

### v2.0 (2025-10-30)
✨ 新增智能标签功能
✨ 优化AI提示词结构
✨ 增强标签提取逻辑
✨ 添加回退机制
🐛 修复标签显示问题
📝 更新文档说明

### v1.0
✨ 初始版本
✨ 基础搜索和详情展示
✨ AI分析集成

---

## 💡 技术栈

- **前端**: HTML5, CSS3, Vanilla JavaScript
- **后端**: N8N (Low-code Automation)
- **AI**: DeepSeek Chat Model
- **数据**: Google Sheets
- **向量检索**: Pinecone (可选)

---

## 📞 技术支持

如有问题，请查看：
1. N8N工作流执行日志
2. 浏览器控制台（F12）
3. Network面板查看API请求

---

## 🚀 v2.1 计划功能

- [ ] 标签点击筛选功能
- [ ] 标签颜色主题
- [ ] 更多AI分析维度（安全性、舒适性等）
- [ ] 车型对比功能
- [ ] 用户评论集成

---

**享受你的汽车探索之旅！** 🚗✨

