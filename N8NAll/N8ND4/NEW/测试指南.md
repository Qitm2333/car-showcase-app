# 🧪 AI车型分析助手 - 完整测试指南

## 📋 测试前准备

### ✅ 确认配置
1. **N8N工作流已激活** - 右上角显示"Active"
2. **Webhook URL已保存** - 在调试面板确认
3. **Google Sheets已授权** - OAuth2连接正常
4. **DeepSeek API有额度** - 确保能调用

---

## 🎯 测试流程（按顺序进行）

### 第1步：测试基础对话（sendMessage）

#### 操作步骤：
1. 打开 `NEW/ai-chat-demo.html`
2. 点击右侧"💾 保存配置"
3. 在输入框输入：`问界M7的外观设计怎么样？`
4. 点击"发送"

#### 预期结果：
- ✅ 用户消息立即显示
- ✅ AI回复显示（50字以内）
- ✅ 左侧出现新对话，标题自动生成（如"问界M7外观设计"）
- ✅ 调试日志显示：
  ```
  📤 发送请求: sendMessage
  📥 收到响应
  📝 conversationHistory已更新
  📝 标题已更新: 问界M7外观设计
  ```

#### 故障排查：
- ❌ 如果没有AI回复 → 检查DeepSeek API
- ❌ 如果标题是"未命名对话" → 检查"处理AI响应"节点
- ❌ 如果没有保存到Google Sheets → 检查OAuth2权限

---

### 第2步：测试对话记忆

#### 操作步骤：
1. 继续输入：`那内饰呢？`
2. 点击"发送"

#### 预期结果：
- ✅ AI能理解上下文，知道是在问问界M7的内饰
- ✅ 标题保持不变（不会变成"那内饰呢？"）
- ✅ conversationHistory累积更新

#### 故障排查：
- ❌ 如果AI答非所问 → conversationHistory没有传递
- ❌ 如果标题变了 → ProcessMessage节点的title逻辑有问题

---

### 第3步：测试对话列表（getDialogueList）

#### 操作步骤：
1. 刷新页面
2. 观察左侧对话列表

#### 预期结果：
- ✅ 自动加载历史对话
- ✅ 显示刚才创建的对话
- ✅ 标题正确、标签正确
- ✅ 调试日志显示：
  ```
  📥 已加载保存的Webhook URL
  📥 已加载保存的User ID
  🚀 系统初始化完成
  📤 发送请求: getDialogueList
  📥 收到响应
  ```

#### 故障排查：
- ❌ 如果列表为空 → 检查Google Sheets的AIDialogues表
- ❌ 如果标签格式错误 → 前端tags兼容性处理

---

### 第4步：测试对话详情（getDialogueDetail）

#### 操作步骤：
1. 点击左侧的历史对话

#### 预期结果：
- ✅ 右侧显示完整对话历史
- ✅ conversationHistory被加载
- ✅ 可以继续对话
- ✅ 调试日志显示：
  ```
  📤 发送请求: getDialogueDetail
  📥 加载标题: 问界M7外观设计
  📥 加载conversationHistory: ...
  ```

---

### 第5步：测试报告生成（generateReport）⭐ 重点

#### 操作步骤：
1. 确保当前对话中讨论了具体车型（如：问界M7、理想L9）
2. 点击右上角"📊 生成报告"按钮

#### 预期结果：
- ✅ 按钮显示"生成中..."
- ✅ 调试日志显示：
  ```
  📊 开始生成报告，dialogueID: dlg_xxx
  📤 发送请求: generateReport
  📥 收到响应
  ✅ 报告生成成功！报告ID: report_xxx
  ```
- ✅ 弹窗提示："✅ 报告已在新窗口打开"
- ✅ 新窗口打开，显示漂亮的对比报告
- ✅ 报告包含：
  - 标题（对话标题）
  - 生成时间
  - 对比表格（车型 x 维度）
  - 打印按钮

#### 故障排查：

##### 问题1：提示"对话内容为空"
**原因**：conversationHistory没有维护
**解决**：检查sendMessage是否正确更新conversationHistory

##### 问题2：弹出窗口被阻止
**原因**：浏览器阻止了弹窗
**解决**：允许浏览器弹窗权限

##### 问题3：报告显示"车型1"、"车型2"（默认数据）
**原因**：AI返回的JSON格式不对
**解决**：
- 查看调试日志中的AI返回内容
- 检查"AI Agent1"节点的输出
- 可能需要调整prompt

##### 问题4：报告显示"未提及"
**原因**：对话中没有明确提到该维度
**解决**：正常现象，继续对话讨论更多维度

---

## 🎨 测试报告生成的最佳实践

### **推荐对话示例：**

```
轮1: "请帮我对比一下问界M7和理想L9的外观设计"
轮2: "那内饰呢？"
轮3: "空间表现如何？"
轮4: "价格方面呢？"
```

这样AI能提取到：
- **车型**：问界M7、理想L9
- **维度**：外观设计、内饰、空间、价格

---

## 📊 完整功能清单

| 功能 | 测试 | 状态 |
|------|------|------|
| 新对话创建 | 第1步 | ⬜ |
| AI标题生成 | 第1步 | ⬜ |
| 对话记忆 | 第2步 | ⬜ |
| 标题保持不变 | 第2步 | ⬜ |
| 历史列表加载 | 第3步 | ⬜ |
| 对话详情加载 | 第4步 | ⬜ |
| 报告生成 | 第5步 | ⬜ |
| HTML报告样式 | 第5步 | ⬜ |
| 打印PDF功能 | 第5步 | ⬜ |

---

## 🐛 常见问题速查

### Q1: AI回复太长，超过50字了
**A**: 调整"转换为AI格式"节点的prompt，强调"必须在50字以内"

### Q2: 标题生成的不好
**A**: 调整prompt中的示例，让AI知道什么样的标题是好的

### Q3: 报告表格空的
**A**: 检查对话是否提到了具体车型名称

### Q4: 打印PDF时样式乱了
**A**: 检查`@media print`的CSS规则

---

## ✅ 测试完成后

如果所有测试通过，恭喜你！🎉

你已经完成了一个完整的AI对话分析系统，包括：
- ✅ 智能对话（带记忆）
- ✅ 标题自动生成
- ✅ 对话历史管理
- ✅ AI分析报告生成
- ✅ 精美的HTML报告

---

**现在开始测试吧！按照步骤1-5依次进行！** 🚀

