{
  "nodes": [
    {
      "parameters": {
        "jsCode": "const action = $input.item.json.body.action;\nreturn {json: {action: action, data: $input.item.json.body}};"
      },
      "id": "d370aabe-0d95-4974-8677-9f2d83f2ace6",
      "name": "Router",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3760,
        6848
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.action}}",
                    "rightValue": "sendMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "condition-1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "sendMessage"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.action}}",
                    "rightValue": "generateReport",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "condition-2"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "generateReport"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.action}}",
                    "rightValue": "getDialogueList",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "condition-3"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "getDialogueList"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.action}}",
                    "rightValue": "getDialogueDetail",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "condition-4"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "getDialogueDetail"
            }
          ]
        },
        "options": {}
      },
      "id": "bb958d21-b706-4179-8dcd-8df94a51e226",
      "name": "Switch",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        4000,
        6832
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json.data;\nconst content = data.content || '';\nconst conversationHistory = data.conversationHistory || '';\nconst dialogueID = data.dialogueID || 'dlg_' + Date.now();\nconst userID = data.userID || 'testCode';\nconst isNewDialogue = !data.dialogueID;\n\n// æå–å…³é”®è¯æ ‡ç­¾\nconst keywords = ['å¤–è§‚','å†…é¥°','æ€§èƒ½','ç»­èˆª','ç©ºé—´','é…ç½®','æ™ºèƒ½åŒ–','ä»·æ ¼','å®‰å…¨','èˆ’é€‚'];\nconst extractedTags = keywords.filter(k => content.includes(k));\n\n// â­ æ ‡é¢˜ä»å‰ç«¯ä¼ æ¥ï¼Œä¸åœ¨è¿™é‡Œç”Ÿæˆ\nconst title = data.title || 'æœªå‘½åå¯¹è¯';\n\nconst timestamp = new Date().toISOString();\nconst messageID_user = 'msg_' + Date.now() + '_user';\n\nreturn {\n  json: {\n    dialogueID: dialogueID,\n    userID: userID,\n    title: title,  // â­ ç›´æ¥ä½¿ç”¨å‰ç«¯ä¼ æ¥çš„æ ‡é¢˜\n    tags: extractedTags.join(','),\n    createTime: timestamp,\n    status: 'active',\n    isNewDialogue: isNewDialogue,\n    conversationHistory: conversationHistory,\n    userMessage: {\n      messageID: messageID_user,\n      dialogueID: dialogueID,\n      role: 'user',\n      content: content,\n      timestamp: timestamp\n    }\n  }\n};"
      },
      "id": "23a4e674-e91c-4c30-b78b-9f680f4711cc",
      "name": "ProcessMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4288,
        6464
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json.isNewDialogue}}",
                    "rightValue": true,
                    "operator": {
                      "type": "boolean",
                      "operation": "true"
                    },
                    "id": "condition-new"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "æ–°å¯¹è¯"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "80888c7d-9a9c-44a3-b815-55cf68897893",
      "name": "åˆ¤æ–­æ˜¯å¦æ–°å¯¹è¯",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        4496,
        6464
      ]
    },
    {
      "parameters": {
        "jsCode": "// â­ ä»æ™ºèƒ½é€‰å›¾åˆå¹¶èŠ‚ç‚¹è·å–æ•°æ®\nconst mergedData = $('æ™ºèƒ½é€‰å›¾åˆå¹¶').first().json;\nconst aiOutput = mergedData.aiOutput || '';\nconst dialogueID = mergedData.dialogueID;\nconst title = mergedData.title;\nconst vehiclesWithImages = mergedData.vehicles || [];\n\n// è§£æAIè¿”å›çš„JSON\nlet reportData = {\n  vehicles: [],\n  dimensions: []\n};\n\ntry {\n  const jsonMatch = aiOutput.match(/```json\\s*([\\s\\S]+?)\\s*```/) || \n                    aiOutput.match(/\\{[\\s\\S]+\\}/);\n  \n  if (jsonMatch) {\n    const jsonStr = jsonMatch[1] || jsonMatch[0];\n    reportData = JSON.parse(jsonStr);\n  }\n} catch (e) {\n  reportData = {\n    vehicles: vehiclesWithImages.map(v => ({name: v.name})),\n    dimensions: [\n      {\n        name: 'è§£æå¤±è´¥', \n        [vehiclesWithImages[0]?.name]: {label: 'è¯·é‡è¯•', desc1: 'æ•°æ®ç”Ÿæˆå¼‚å¸¸', desc2: ''},\n        [vehiclesWithImages[1]?.name]: {label: 'è¯·é‡è¯•', desc1: 'æ•°æ®ç”Ÿæˆå¼‚å¸¸', desc2: ''}\n      }\n    ]\n  };\n}\n\nconst dimensions = reportData.dimensions || [];\n\n// â­ ç”Ÿæˆè¡¨å¤´ï¼ˆä½¿ç”¨åŸå§‹é«˜æ¸…å›¾ç‰‡ï¼‰\nlet tableHeaders = '<th>å¯¹æ¯”ç»´åº¦</th>';\nfor (const v of vehiclesWithImages) {\n  const originalUrl = v.imageUrl || '';\n  \n  // ğŸ¯ ä¼˜å…ˆä½¿ç”¨åŸå§‹URLï¼ˆæœ€é«˜æ¸…ï¼‰\n  const primaryUrl = originalUrl;\n  \n  // ğŸ›¡ï¸ å¤‡ç”¨ï¼šä»£ç†URLï¼ˆé«˜è´¨é‡ï¼Œä¸å‹ç¼©ï¼‰\n  const proxiedUrl = originalUrl.startsWith('http') \n    ? `https://images.weserv.nl/?url=${encodeURIComponent(originalUrl)}&q=95&il`\n    : originalUrl;\n  \n  // ğŸ¨ æœ€ç»ˆé™çº§ï¼šSVGå ä½å›¾\n  const fallbackUrl = `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 267'%3E%3Crect fill='%23f0f0f0' width='400' height='267'/%3E%3Ctext x='200' y='133' font-size='20' text-anchor='middle' fill='%23999'%3E${encodeURIComponent(v.name)}%3C/text%3E%3C/svg%3E`;\n  \n  tableHeaders += `<th>\n    <div class=\"car-header\">\n      <img src=\"${primaryUrl}\" \n           alt=\"${v.name}\" \n           class=\"car-image\" \n           data-proxy=\"${proxiedUrl}\"\n           data-fallback=\"${fallbackUrl}\"\n           crossorigin=\"anonymous\"\n           onerror=\"handleImageError(this)\"\n           onload=\"this.style.opacity=1;\"\n           onclick=\"openImageModal('${primaryUrl}', '${v.name}')\">\n      <div class=\"car-name\">${v.name}</div>\n    </div>\n  </th>`;\n}\n\n// ç”Ÿæˆè¡¨æ ¼è¡Œ\nlet tableRows = '';\nfor (const dim of dimensions) {\n  let row = '<tr><td>' + dim.name + '</td>';\n  \n  for (const v of vehiclesWithImages) {\n    const data = dim[v.name];\n    if (typeof data === 'object' && data.label) {\n      row += '<td><span class=\"dimension-label\">' + data.label + '</span>';\n      if (data.desc1) {\n        row += '<span class=\"dimension-desc\">' + data.desc1 + '</span>';\n      }\n      if (data.desc2) {\n        row += '<span class=\"dimension-desc\">' + data.desc2 + '</span>';\n      }\n      row += '</td>';\n    } else {\n      row += '<td>' + (data || 'æš‚æ— æ•°æ®') + '</td>';\n    }\n  }\n  \n  row += '</tr>';\n  tableRows += row;\n}\n\n// â­ ç”Ÿæˆå®Œæ•´HTML\nconst html = `<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${title} - AIåˆ†ææŠ¥å‘Š</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n        \n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Helvetica Neue', sans-serif;\n            background: #fafafa;\n            padding: 60px 40px;\n            color: #333;\n        }\n        \n        .container {\n            max-width: 1400px;\n            margin: 0 auto;\n        }\n        \n        .header {\n            margin-bottom: 60px;\n            border-left: 4px solid #667eea;\n            padding-left: 20px;\n        }\n        \n        .header h1 {\n            font-size: 28px;\n            font-weight: 600;\n            margin-bottom: 8px;\n            letter-spacing: -0.5px;\n        }\n        \n        .header p {\n            font-size: 14px;\n            color: #666;\n            font-weight: 300;\n            letter-spacing: 0.5px;\n        }\n        \n        .toolbar {\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            display: flex;\n            flex-direction: column;\n            gap: 10px;\n            z-index: 1000;\n        }\n        \n        .toolbar-row {\n            display: flex;\n            gap: 10px;\n        }\n        \n        .btn {\n            padding: 12px 24px;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            border: none;\n            border-radius: 50px;\n            font-weight: 600;\n            cursor: pointer;\n            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n            transition: all 0.3s;\n            font-size: 14px;\n            white-space: nowrap;\n        }\n        \n        .btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);\n        }\n        \n        .btn-secondary {\n            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);\n            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.4);\n        }\n        \n        .btn-secondary:hover {\n            box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);\n        }\n        \n        .btn-success {\n            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);\n            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);\n        }\n        \n        .btn-success:hover {\n            box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);\n        }\n        \n        .size-controls {\n            background: white;\n            padding: 15px 20px;\n            border-radius: 20px;\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n            display: flex;\n            flex-direction: column;\n            gap: 12px;\n        }\n        \n        .control-item {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n        }\n        \n        .control-item label {\n            font-size: 13px;\n            color: #666;\n            font-weight: 500;\n            white-space: nowrap;\n            min-width: 50px;\n        }\n        \n        .slider {\n            width: 120px;\n            height: 6px;\n            border-radius: 3px;\n            outline: none;\n            -webkit-appearance: none;\n        }\n        \n        .height-slider {\n            background: linear-gradient(to right, #667eea, #764ba2);\n        }\n        \n        .width-slider {\n            background: linear-gradient(to right, #f093fb, #f5576c);\n        }\n        \n        .image-slider {\n            background: linear-gradient(to right, #43e97b, #38f9d7);\n        }\n        \n        .slider::-webkit-slider-thumb {\n            -webkit-appearance: none;\n            width: 18px;\n            height: 18px;\n            border-radius: 50%;\n            background: white;\n            cursor: pointer;\n            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        }\n        \n        .slider::-moz-range-thumb {\n            width: 18px;\n            height: 18px;\n            border-radius: 50%;\n            background: white;\n            cursor: pointer;\n            border: none;\n            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);\n        }\n        \n        .value-display {\n            font-size: 13px;\n            font-weight: 600;\n            min-width: 45px;\n            text-align: right;\n        }\n        \n        .height-value {\n            color: #667eea;\n        }\n        \n        .width-value {\n            color: #f5576c;\n        }\n        \n        .image-value {\n            color: #38f9d7;\n        }\n        \n        .table-wrapper {\n            background: white;\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);\n        }\n        \n        table {\n            width: 100%;\n            border-collapse: collapse;\n        }\n        \n        thead tr {\n            background: #f8f9fc;\n            border-bottom: 1px solid #e5e7eb;\n        }\n        \n        th {\n            text-align: center;\n            font-weight: 600;\n            font-size: 14px;\n            color: #333;\n            letter-spacing: 0.3px;\n            vertical-align: middle;\n        }\n        \n        th:first-child {\n            width: 15%;\n        }\n        \n        .car-header {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 12px;\n            padding: 10px;\n        }\n        \n        .car-image {\n            object-fit: contain;\n            border-radius: 8px;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n            background: #fafafa;\n            opacity: 0;\n            transition: all 0.3s ease;\n            cursor: zoom-in;\n            image-rendering: -webkit-optimize-contrast;\n            image-rendering: crisp-edges;\n        }\n        \n        .car-image:hover {\n            transform: scale(1.05);\n            box-shadow: 0 4px 16px rgba(0,0,0,0.15);\n        }\n        \n        .car-image:not([src*=\"data:image\"]) {\n            filter: none !important;\n            -webkit-filter: none !important;\n        }\n        \n        .car-name {\n            font-weight: 600;\n            font-size: 15px;\n            color: #333;\n        }\n        \n        tbody tr {\n            border-bottom: 1px solid #f0f0f0;\n            transition: background-color 0.2s ease;\n        }\n        \n        tbody tr:hover {\n            background: #fafbff;\n        }\n        \n        tbody tr:last-child {\n            border-bottom: none;\n        }\n        \n        td {\n            font-size: 14px;\n            color: #555;\n            text-align: center;\n            vertical-align: middle;\n        }\n        \n        td:first-child {\n            font-weight: 500;\n            color: #333;\n            background: #f9fafb;\n        }\n        \n        .dimension-label {\n            display: block;\n            font-weight: 500;\n            color: #333;\n            margin-bottom: 4px;\n            font-size: 14px;\n        }\n        \n        .dimension-desc {\n            display: block;\n            font-size: 12px;\n            color: #666;\n            font-weight: 400;\n            margin-top: 4px;\n            line-height: 1.5;\n        }\n        \n        .image-modal {\n            display: none;\n            position: fixed;\n            z-index: 2000;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.9);\n            justify-content: center;\n            align-items: center;\n            animation: fadeIn 0.3s ease;\n        }\n        \n        .image-modal.active {\n            display: flex;\n        }\n        \n        .modal-content {\n            max-width: 90%;\n            max-height: 90%;\n            object-fit: contain;\n            border-radius: 12px;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n            animation: zoomIn 0.3s ease;\n        }\n        \n        .modal-close {\n            position: absolute;\n            top: 30px;\n            right: 40px;\n            font-size: 40px;\n            color: white;\n            cursor: pointer;\n            font-weight: 300;\n            transition: transform 0.2s;\n        }\n        \n        .modal-close:hover {\n            transform: scale(1.2);\n        }\n        \n        .modal-title {\n            position: absolute;\n            bottom: 30px;\n            left: 50%;\n            transform: translateX(-50%);\n            color: white;\n            font-size: 20px;\n            font-weight: 600;\n            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);\n        }\n        \n        @keyframes fadeIn {\n            from { opacity: 0; }\n            to { opacity: 1; }\n        }\n        \n        @keyframes zoomIn {\n            from { transform: scale(0.8); opacity: 0; }\n            to { transform: scale(1); opacity: 1; }\n        }\n        \n        [contenteditable=\"true\"] {\n            outline: 2px dashed #667eea;\n            outline-offset: 2px;\n            background: #fffbf0;\n            border-radius: 4px;\n        }\n        \n        [contenteditable=\"true\"]:focus {\n            outline: 2px solid #667eea;\n            background: #fff;\n        }\n        \n        .footer {\n            margin-top: 40px;\n            text-align: center;\n            color: #999;\n            font-size: 12px;\n        }\n        \n        @media print {\n            body {\n                background: white;\n                padding: 20px;\n            }\n            \n            .toolbar {\n                display: none;\n            }\n            \n            .image-modal {\n                display: none !important;\n            }\n            \n            .container {\n                box-shadow: none;\n            }\n            \n            [contenteditable=\"true\"] {\n                outline: none;\n                background: white;\n            }\n            \n            .car-image {\n                cursor: default;\n            }\n        }\n        \n        @media (max-width: 768px) {\n            body {\n                padding: 40px 20px;\n            }\n            \n            .toolbar {\n                top: 10px;\n                right: 10px;\n            }\n            \n            .toolbar-row {\n                flex-direction: column;\n            }\n            \n            .size-controls {\n                padding: 12px 16px;\n            }\n            \n            .control-item {\n                flex-direction: column;\n                align-items: stretch;\n            }\n            \n            .slider {\n                width: 100%;\n            }\n            \n            .modal-close {\n                top: 15px;\n                right: 20px;\n                font-size: 30px;\n            }\n            \n            .modal-title {\n                font-size: 16px;\n                bottom: 15px;\n            }\n            \n            .header {\n                margin-bottom: 40px;\n            }\n            \n            .header h1 {\n                font-size: 22px;\n            }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"toolbar\">\n        <div class=\"toolbar-row\">\n            <button class=\"btn\" onclick=\"window.print()\">ğŸ–¨ï¸ æ‰“å°PDF</button>\n            <button class=\"btn btn-secondary\" onclick=\"toggleEdit()\" id=\"editBtn\">âœï¸ ç¼–è¾‘</button>\n            <button class=\"btn btn-success\" onclick=\"transposeTable()\" id=\"transposeBtn\">ğŸ”„ è½¬ç½®</button>\n        </div>\n        <div class=\"size-controls\">\n            <div class=\"control-item\">\n                <label>ğŸ–¼ï¸ å›¾ç‰‡</label>\n                <input type=\"range\" min=\"150\" max=\"500\" value=\"250\" class=\"slider image-slider\" id=\"imageSlider\" oninput=\"adjustImageSize(this.value)\">\n                <span class=\"value-display image-value\" id=\"imageValue\">250px</span>\n            </div>\n            <div class=\"control-item\">\n                <label>ğŸ“ è¡Œé«˜</label>\n                <input type=\"range\" min=\"10\" max=\"100\" value=\"28\" class=\"slider height-slider\" id=\"heightSlider\" oninput=\"adjustHeight(this.value)\">\n                <span class=\"value-display height-value\" id=\"heightValue\">28px</span>\n            </div>\n            <div class=\"control-item\">\n                <label>ğŸ“ å®½åº¦</label>\n                <input type=\"range\" min=\"10\" max=\"60\" value=\"20\" class=\"slider width-slider\" id=\"widthSlider\" oninput=\"adjustWidth(this.value)\">\n                <span class=\"value-display width-value\" id=\"widthValue\">20px</span>\n            </div>\n        </div>\n    </div>\n    \n    <div class=\"image-modal\" id=\"imageModal\" onclick=\"closeImageModal()\">\n        <span class=\"modal-close\">&times;</span>\n        <img src=\"\" alt=\"\" class=\"modal-content\" id=\"modalImage\" onclick=\"event.stopPropagation()\">\n        <div class=\"modal-title\" id=\"modalTitle\"></div>\n    </div>\n    \n    <div class=\"container\">\n        <div class=\"header\">\n            <h1>ğŸš— ${title}</h1>\n            <p>AIæ™ºèƒ½åˆ†ææŠ¥å‘Š Â· ç”Ÿæˆæ—¶é—´ï¼š${new Date().toLocaleString('zh-CN')}</p>\n        </div>\n        \n        <div class=\"table-wrapper\" id=\"tableWrapper\">\n            <table id=\"reportTable\">\n                <thead>\n                    <tr>${tableHeaders}</tr>\n                </thead>\n                <tbody>\n                    ${tableRows}\n                </tbody>\n            </table>\n        </div>\n        \n        <div class=\"footer\">\n            <p>æŠ¥å‘ŠID: report_${dialogueID} Â· ç”±AIè½¦å‹åˆ†æåŠ©æ‰‹ç”Ÿæˆ Â· ç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹</p>\n        </div>\n    </div>\n    \n    <script>\n        // â­ å›¾ç‰‡é”™è¯¯å¤„ç†ï¼ˆ3å±‚é™çº§ï¼šåŸå§‹ â†’ ä»£ç† â†’ å ä½å›¾ï¼‰\n        function handleImageError(img) {\n            if (!img.dataset.failedOnce) {\n                console.log('å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ä»£ç†:', img.alt);\n                img.dataset.failedOnce = 'true';\n                img.src = img.dataset.proxy;\n            } else if (!img.dataset.failedTwice) {\n                console.log('ä»£ç†ä¹Ÿå¤±è´¥ï¼Œä½¿ç”¨å ä½å›¾:', img.alt);\n                img.dataset.failedTwice = 'true';\n                img.onerror = null;\n                img.src = img.dataset.fallback;\n            }\n        }\n        \n        let isEditing = false;\n        let isTransposed = false;\n        let originalTableHTML = '';\n        let currentHeight = 28;\n        let currentWidth = 20;\n        let currentImageSize = 250;\n        \n        window.onload = function() {\n            const savedHeight = localStorage.getItem('reportRowHeight') || '28';\n            const savedWidth = localStorage.getItem('reportRowWidth') || '20';\n            const savedImageSize = localStorage.getItem('reportImageSize') || '250';\n            \n            document.getElementById('heightSlider').value = savedHeight;\n            document.getElementById('widthSlider').value = savedWidth;\n            document.getElementById('imageSlider').value = savedImageSize;\n            \n            currentHeight = parseInt(savedHeight);\n            currentWidth = parseInt(savedWidth);\n            currentImageSize = parseInt(savedImageSize);\n            \n            applySize();\n            applyImageSize();\n        };\n        \n        function adjustImageSize(value) {\n            currentImageSize = parseInt(value);\n            document.getElementById('imageValue').textContent = value + 'px';\n            localStorage.setItem('reportImageSize', value);\n            applyImageSize();\n        }\n        \n        function applyImageSize() {\n            const images = document.querySelectorAll('.car-image');\n            images.forEach(img => {\n                img.style.width = currentImageSize + 'px';\n                img.style.height = (currentImageSize * 0.67) + 'px';\n            });\n        }\n        \n        function adjustHeight(value) {\n            currentHeight = parseInt(value);\n            document.getElementById('heightValue').textContent = value + 'px';\n            localStorage.setItem('reportRowHeight', value);\n            applySize();\n        }\n        \n        function adjustWidth(value) {\n            currentWidth = parseInt(value);\n            document.getElementById('widthValue').textContent = value + 'px';\n            localStorage.setItem('reportRowWidth', value);\n            applySize();\n        }\n        \n        function applySize() {\n            const allCells = document.querySelectorAll('#reportTable td, #reportTable th');\n            \n            allCells.forEach(cell => {\n                if (cell.cellIndex === 0) {\n                    cell.style.paddingTop = currentHeight + 'px';\n                    cell.style.paddingBottom = currentHeight + 'px';\n                    cell.style.paddingLeft = '20px';\n                    cell.style.paddingRight = '20px';\n                } else {\n                    cell.style.padding = currentHeight + 'px ' + currentWidth + 'px';\n                }\n                \n                cell.style.verticalAlign = 'middle';\n                cell.style.height = 'auto';\n                cell.style.minHeight = (currentHeight * 2) + 'px';\n            });\n        }\n        \n        function openImageModal(src, title) {\n            const modal = document.getElementById('imageModal');\n            const modalImg = document.getElementById('modalImage');\n            const modalTitle = document.getElementById('modalTitle');\n            \n            modal.classList.add('active');\n            modalImg.src = src;\n            modalTitle.textContent = title;\n            \n            document.body.style.overflow = 'hidden';\n        }\n        \n        function closeImageModal() {\n            const modal = document.getElementById('imageModal');\n            modal.classList.remove('active');\n            document.body.style.overflow = 'auto';\n        }\n        \n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'Escape') {\n                closeImageModal();\n            }\n        });\n        \n        function toggleEdit() {\n            isEditing = !isEditing;\n            const cells = document.querySelectorAll('td, th');\n            const btn = document.getElementById('editBtn');\n            \n            cells.forEach(cell => {\n                cell.contentEditable = isEditing;\n            });\n            \n            if (isEditing) {\n                btn.textContent = 'âœ… å®Œæˆ';\n                btn.style.background = 'linear-gradient(135deg, #fa709a 0%, #fee140 100%)';\n            } else {\n                btn.textContent = 'âœï¸ ç¼–è¾‘';\n                btn.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';\n            }\n        }\n        \n        function transposeTable() {\n            const table = document.getElementById('reportTable');\n            const wrapper = document.getElementById('tableWrapper');\n            \n            if (!isTransposed) {\n                originalTableHTML = table.outerHTML;\n                \n                const rows = Array.from(table.rows);\n                const maxCols = Math.max(...rows.map(r => r.cells.length));\n                \n                let transposedHTML = '<table id=\"reportTable\">';\n                \n                for (let col = 0; col < maxCols; col++) {\n                    transposedHTML += '<tr>';\n                    for (let row = 0; row < rows.length; row++) {\n                        const cell = rows[row].cells[col];\n                        if (cell) {\n                            const tagName = (col === 0) ? 'th' : 'td';\n                            transposedHTML += '<' + tagName + '>' + cell.innerHTML + '</' + tagName + '>';\n                        }\n                    }\n                    transposedHTML += '</tr>';\n                }\n                \n                transposedHTML += '</table>';\n                wrapper.innerHTML = transposedHTML;\n                \n                setTimeout(() => {\n                    applySize();\n                    applyImageSize();\n                }, 50);\n                \n                document.getElementById('transposeBtn').textContent = 'â†©ï¸ è¿˜åŸ';\n                isTransposed = true;\n            } else {\n                wrapper.innerHTML = originalTableHTML;\n                \n                setTimeout(() => {\n                    applySize();\n                    applyImageSize();\n                }, 50);\n                \n                document.getElementById('transposeBtn').textContent = 'ğŸ”„ è½¬ç½®';\n                isTransposed = false;\n            }\n        }\n    </script>\n</body>\n</html>`;\n\nconst reportID = 'report_' + Date.now();\n\nreturn {\n  json: {\n    success: true,\n    reportID: reportID,\n    htmlContent: html,\n    createTime: new Date().toISOString(),\n    imageStats: mergedData.imageStats\n  }\n};"
      },
      "id": "594d3d39-e353-4e74-87d5-249cc5865819",
      "name": "GenerateReport",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5872,
        6752
      ]
    },
    {
      "parameters": {
        "jsCode": "// ä»Google Sheetsè·å–çš„æ•°æ®\nconst items = $input.all();\n\n// å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œè¿”å›ç©ºåˆ—è¡¨\nif (!items || items.length === 0) {\n  return {\n    json: {\n      success: true,\n      dialogues: [],\n      total: 0\n    }\n  };\n}\n\n// å¤„ç†æ¯ä¸ªå¯¹è¯è®°å½•\nconst dialogues = items.map(item => {\n  const data = item.json;\n  \n  // â­ å°†tagså­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°ç»„ï¼ˆå‰ç«¯éœ€è¦ï¼‰\n  let tagsArray = [];\n  if (data.tags) {\n    tagsArray = data.tags.split(',').map(t => t.trim()).filter(t => t);\n  }\n  \n  // â­ æå–conversationHistoryçš„æœ€åä¸€æ¡AIå›å¤ä½œä¸ºpreview\n  let preview = 'æš‚æ— å†…å®¹';\n  if (data.conversationHistory) {\n    const pairs = data.conversationHistory.split('----').filter(s => s.trim());\n    // æ‰¾æœ€åä¸€æ¡AISpeak\n    for (let i = pairs.length - 1; i >= 0; i--) {\n      if (pairs[i].startsWith('AISpeak:')) {\n        preview = pairs[i].replace('AISpeak:', '').substring(0, 50);\n        if (pairs[i].replace('AISpeak:', '').length > 50) {\n          preview += '...';\n        }\n        break;\n      }\n    }\n  }\n  \n  return {\n    dialogueID: data.dialogueID,\n    title: data.title || 'æœªå‘½åå¯¹è¯',\n    tags: tagsArray,  // â­ æ•°ç»„æ ¼å¼\n    createTime: data.createTime,\n    preview: preview,\n    status: data.status\n  };\n});\n\n// â­ æŒ‰createTimeé™åºæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰\ndialogues.sort((a, b) => {\n  const timeA = new Date(a.createTime).getTime();\n  const timeB = new Date(b.createTime).getTime();\n  return timeB - timeA;  // é™åº\n});\n\nreturn {\n  json: {\n    success: true,\n    dialogues: dialogues,\n    total: dialogues.length\n  }\n};"
      },
      "id": "e188bfd7-37d5-4158-8a17-4d4b2e9c3591",
      "name": "GetDialogueList",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4496,
        7024
      ]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{$json}}",
        "options": {}
      },
      "id": "7d072fe1-f8fb-46e6-b812-e81e33299c15",
      "name": "ç»Ÿä¸€å“åº”",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        7040,
        6864
      ]
    },
    {
      "parameters": {
        "jsCode": "const originalData = $('å¤„ç†AIå“åº”').first().json;\nreturn {json: originalData.response};"
      },
      "id": "6c38f1d4-2283-46f7-ab79-c373c721f5a8",
      "name": "æ ¼å¼åŒ–å“åº”1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6528,
        6480
      ]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconst userContent = data.userMessage.content;\n\nconst initialHistory = 'userSpeak:' + userContent + '----';\n\nreturn {\n  json: {\n    dialogueID: data.dialogueID,\n    userID: data.userID,\n    title: data.title,\n    tags: data.tags,\n    createTime: data.createTime,\n    status: data.status,\n    conversationHistory: initialHistory,\n    userMessage: data.userMessage,\n    aiMessage: data.aiMessage\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4784,
        6304
      ],
      "id": "45837232-4a68-4cf0-8a33-e750026806bb",
      "name": "åˆå§‹åŒ–å¯¹è¯"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        5248,
        6480
      ],
      "id": "a9212692-1743-4f98-89e0-7da3688229a4",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [
        5248,
        6624
      ],
      "id": "c18c40bf-f03b-424c-a6de-30f573654031",
      "name": "DeepSeek Chat Model",
      "credentials": {
        "deepSeekApi": {
          "id": "Rq6VyJR7LeyTkMK8",
          "name": "DeepSeek account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconst conversationHistory = data.conversationHistory || '';\n\nconst pairs = conversationHistory.split('----').filter(s => s.trim());\nconst chatInput = [];\n\nfor (const pair of pairs) {\n  if (pair.startsWith('userSpeak:')) {\n    chatInput.push('ç”¨æˆ·: ' + pair.replace('userSpeak:', ''));\n  } else if (pair.startsWith('AISpeak:')) {\n    chatInput.push('åŠ©æ‰‹: ' + pair.replace('AISpeak:', ''));\n  }\n}\n\n// â­ åˆ¤æ–­æ˜¯å¦æ˜¯æ–°å¯¹è¯çš„ç¬¬ä¸€è½®ï¼ˆåªæœ‰ä¸€æ¡userSpeakï¼‰\nconst isFirstMessage = pairs.length === 1 && pairs[0].startsWith('userSpeak:');\n\n// â­ æ·»åŠ ç³»ç»Ÿè§’è‰²è®¾å®šï¼ˆæ‰€æœ‰å¯¹è¯éƒ½æœ‰ï¼‰\nlet prompt = 'ã€ç³»ç»Ÿè®¾å®šã€‘ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„ä¸–ç•Œçº§æ±½è½¦è®¾è®¡å¸ˆåŠ©æ‰‹ï¼Œæ“…é•¿åˆ†æè½¦è¾†å¤–è§‚ã€å†…é¥°ã€æ€§èƒ½ç­‰è®¾è®¡ç»†èŠ‚ã€‚è¯·ç”¨ç®€æ´ä¸“ä¸šçš„è¯­è¨€å›å¤ï¼Œæ§åˆ¶åœ¨50å­—ä»¥å†…ã€‚\\n\\n';\n\nprompt += chatInput.join('\\n');\n\nif (isFirstMessage) {\n  // â­ ç¬¬ä¸€è½®å¯¹è¯ï¼Œè¦æ±‚AIç”Ÿæˆæ ‡é¢˜ï¼ˆç”¨æ¸…æ™°çš„æ ¼å¼ï¼‰\n  prompt += `\n\nã€é‡è¦ã€‘è¯·ä¸¥æ ¼æŒ‰ä»¥ä¸‹æ ¼å¼å›å¤ï¼Œæ ‡é¢˜å’Œæ­£æ–‡ä¹‹é—´ç”¨ç©ºè¡Œåˆ†éš”ï¼š\n\nç¬¬ä¸€è¡Œï¼š[ä¸ºæœ¬æ¬¡å¯¹è¯ç”Ÿæˆä¸€ä¸ª5-10å­—çš„ç®€æ´æ ‡é¢˜]\n\nç¬¬äºŒè¡Œï¼šç©ºè¡Œ\n\nç¬¬ä¸‰è¡Œï¼š[ä½ çš„ä¸“ä¸šå›å¤ï¼Œè¦è¡¨ç°éå¸¸ä»”ç»†ï¼Œ50å­—ä»¥å†…]\n\nç¤ºä¾‹æ ¼å¼ï¼š\né—®ç•ŒM7å¤–è§‚è®¾è®¡\n\nè¿™è¾†è½¦M7é‡‡ç”¨è´¯ç©¿å¼å¤´ç¯ä¸æç®€å‹é¢ï¼Œè¥é€ ç§‘æŠ€æ„Ÿï¼Œé£é˜»ç³»æ•°ä¼˜ç§€ã€‚`;\n} else {\n  // åç»­å¯¹è¯ï¼Œæ­£å¸¸å›å¤\n  prompt += '\\n\\nè¯·ä»¥ä¸“ä¸šæ±½è½¦è®¾è®¡å¸ˆçš„è§’åº¦å’Œç”¨æˆ·è®¨è®ºï¼Œè¦è¡¨ç°çš„ä»”ç»†ï¼ˆ50å­—ä»¥å†…ï¼‰ï¼š';\n}\n\nreturn {\n  json: {\n    conversationHistory: data.conversationHistory,\n    dialogueID: data.dialogueID,\n    userID: data.userID,\n    title: data.title,\n    tags: data.tags,\n    createTime: data.createTime,\n    status: data.status,\n    chatInput: prompt,\n    isFirstMessage: isFirstMessage\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5056,
        6480
      ],
      "id": "42dd2252-6e4a-49e1-bcac-78c0cfcf6953",
      "name": "è½¬æ¢ä¸ºAIæ ¼å¼"
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconst aiResponse = data.output || '';\n\n// â­ ä»\"è½¬æ¢ä¸ºAIæ ¼å¼\"èŠ‚ç‚¹è¯»å–isFirstMessage\nconst convertData = $('è½¬æ¢ä¸ºAIæ ¼å¼').first().json;\nconst isFirstMessage = convertData.isFirstMessage || false;\n\nconst conversationHistory = convertData.conversationHistory || '';\nlet finalTitle = convertData.title || 'æœªå‘½åå¯¹è¯';\nlet finalReply = aiResponse;\n\n// â­ å¦‚æœæ˜¯ç¬¬ä¸€æ¡æ¶ˆæ¯ï¼Œæå–æ ‡é¢˜\nif (isFirstMessage && aiResponse) {\n  // æŒ‰åŒæ¢è¡Œç¬¦åˆ†å‰²\n  const parts = aiResponse.split('\\n\\n');\n  \n  if (parts.length >= 2 && parts[0].trim()) {\n    finalTitle = parts[0].trim();\n    finalReply = parts.slice(1).join('\\n\\n').trim();\n  } else {\n    // Fallback\n    const userContent = conversationHistory.match(/userSpeak:(.+?)----/);\n    if (userContent && userContent[1]) {\n      finalTitle = userContent[1].substring(0, 20) + (userContent[1].length > 20 ? '...' : '');\n    }\n  }\n}\n\nconst updatedHistory = conversationHistory + 'AISpeak:' + finalReply + '----';\n\nconst messageID = 'msg_' + Date.now();\n\nconst tagsArray = convertData.tags ? convertData.tags.split(',').filter(t => t.trim()) : [];\n\nreturn {\n  json: {\n    dialogueID: convertData.dialogueID,\n    userID: convertData.userID,\n    title: finalTitle,\n    tags: convertData.tags,\n    createTime: convertData.createTime,\n    status: convertData.status,\n    conversationHistory: updatedHistory,\n    response: {\n      success: true,\n      dialogueID: convertData.dialogueID,\n      messageID: messageID,\n      aiReply: finalReply,\n      title: finalTitle,\n      extractedTags: tagsArray,\n      conversationHistory: updatedHistory\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5520,
        6480
      ],
      "id": "32bf081e-6fff-41e8-b021-06f12ff7a7ac",
      "name": "å¤„ç†AIå“åº”",
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ",
          "mode": "list",
          "cachedResultName": "CarSheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1586220630,
          "mode": "list",
          "cachedResultName": "AIDialogues",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit#gid=1586220630"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "userID": "={{ $json.userID }}",
            "status": "={{ $json.status }}",
            "dialogueID": "={{$json.dialogueID}}",
            "title": "={{ $json.title && $json.title !== 'æœªå‘½åå¯¹è¯' ? $json.title : undefined }}",
            "tags": "={{$json.tags}}",
            "conversationHistory": "={{$json.conversationHistory}}",
            "createTime": "={{$json.createTime}}"
          },
          "matchingColumns": [
            "dialogueID"
          ],
          "schema": [
            {
              "id": "dialogueID",
              "displayName": "dialogueID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "userID",
              "displayName": "userID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "tags",
              "displayName": "tags",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "conversationHistory",
              "displayName": "conversationHistory",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "createTime",
              "displayName": "createTime",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "bb299c95-f48e-44f2-9062-6b1aa062d940",
      "name": "ä¿å­˜conversationHistoryåˆ°è¡¨æ ¼",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        6080,
        6480
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YS5a72jpKHezwxcc",
          "name": "Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconst existingHistory = data.conversationHistory || '';\nconst userContent = data.userMessage.content;\n\nconst updatedHistory = existingHistory + 'userSpeak:' + userContent + '----';\n\nreturn {\n  json: {\n    dialogueID: data.dialogueID,\n    userID: data.userID,\n    title: data.title,\n    tags: data.tags,\n    createTime: data.createTime,\n    status: data.status,\n    conversationHistory: updatedHistory\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4784,
        6480
      ],
      "id": "72076b5e-778b-4311-ba48-a213f6bee1bd",
      "name": "è¿½åŠ ç”¨æˆ·æ¶ˆæ¯"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ",
          "mode": "list",
          "cachedResultName": "CarSheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1586220630,
          "mode": "list",
          "cachedResultName": "AIDialogues",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit#gid=1586220630"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "dialogueID",
              "lookupValue": "={{$json.data.dialogueID}}"
            }
          ]
        },
        "options": {}
      },
      "id": "7527feb2-b72e-49a9-8d9f-00df699b2e52",
      "name": "è¯»å–å¯¹è¯è¯¦æƒ…",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4288,
        7248
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YS5a72jpKHezwxcc",
          "name": "Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconst sheetData = $('è¯»å–å¯¹è¯è¯¦æƒ…').first().json;\n\nconst dialogueID = sheetData.dialogueID || data.dialogueID;\nconst title = sheetData.title || 'æœªå‘½åå¯¹è¯';\nconst conversationHistory = sheetData.conversationHistory || '';\n\n// è§£æconversationHistoryä¸ºmessagesæ•°ç»„\nconst pairs = conversationHistory.split('----').filter(s => s.trim());\nconst messages = [];\n\nfor (const pair of pairs) {\n  if (pair.startsWith('userSpeak:')) {\n    messages.push({\n      role: 'user',\n      content: pair.replace('userSpeak:', ''),\n      timestamp: new Date().toISOString()\n    });\n  } else if (pair.startsWith('AISpeak:')) {\n    messages.push({\n      role: 'assistant',\n      content: pair.replace('AISpeak:', ''),\n      timestamp: new Date().toISOString()\n    });\n  }\n}\n\nreturn {\n  json: {\n    success: true,\n    dialogueID: dialogueID,\n    title: title,\n    conversationHistory: conversationHistory,\n    messages: messages,\n    totalMessages: messages.length\n  }\n};"
      },
      "id": "898547e3-0a4e-407e-997b-d9761e9ad799",
      "name": "GetDialogueDetail",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4496,
        7248
      ]
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ",
          "mode": "list",
          "cachedResultName": "CarSheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1586220630,
          "mode": "list",
          "cachedResultName": "AIDialogues",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit#gid=1586220630"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "userID",
              "lookupValue": "={{$json.data.userID}}"
            }
          ]
        },
        "options": {}
      },
      "id": "47f974b4-70f8-44d4-a680-bc3e5a5106c1",
      "name": "è¯»å–å¯¹è¯åˆ—è¡¨",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4288,
        7024
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YS5a72jpKHezwxcc",
          "name": "Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "ai-analysis",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "f1bbbc68-c59e-4c18-8e2e-357ba2a2209c",
      "name": "AIåˆ†æå…¥å£",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        3536,
        6848
      ],
      "webhookId": "ai-analysis-webhook"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ",
          "mode": "list",
          "cachedResultName": "CarSheet",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1586220630,
          "mode": "list",
          "cachedResultName": "AIDialogues",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1mjs9hbxuETgarWLqKlHxhK3XQHKG2E6BmkpMs6RUghQ/edit#gid=1586220630"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "dialogueID",
              "lookupValue": "={{$json.data.dialogueID}}"
            }
          ]
        },
        "options": {}
      },
      "id": "1742d82c-e4a8-42c6-b062-9abbb32716dc",
      "name": "è¯»å–æŠ¥å‘Šå¯¹è¯æ•°æ®",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4288,
        6752
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "YS5a72jpKHezwxcc",
          "name": "Google Sheets account 5"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{$json.analysisPrompt}}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        4688,
        6752
      ],
      "id": "0d69aa7d-9fcf-40e3-ab34-4e2aa8ec47b1",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatDeepSeek",
      "typeVersion": 1,
      "position": [
        4688,
        6896
      ],
      "id": "d7b490b4-357d-4479-9f09-1525b5b35560",
      "name": "DeepSeek Chat Model2",
      "credentials": {
        "deepSeekApi": {
          "id": "Rq6VyJR7LeyTkMK8",
          "name": "DeepSeek account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ä»Google Sheetsè¯»å–çš„æ•°æ®\nconst sheetData = $('è¯»å–æŠ¥å‘Šå¯¹è¯æ•°æ®').first().json;\n\nconst dialogueID = sheetData.dialogueID;\nconst title = sheetData.title || 'å¯¹è¯åˆ†æ';\nconst tags = sheetData.tags || '';\nconst conversationHistory = sheetData.conversationHistory || '';\n\n// è§£æå¯¹è¯å†å²\nconst pairs = conversationHistory.split('----').filter(s => s.trim());\nconst dialogue = [];\n\nfor (const pair of pairs) {\n  if (pair.startsWith('userSpeak:')) {\n    dialogue.push('ç”¨æˆ·: ' + pair.replace('userSpeak:', ''));\n  } else if (pair.startsWith('AISpeak:')) {\n    dialogue.push('åŠ©æ‰‹: ' + pair.replace('AISpeak:', ''));\n  }\n}\n\n// æ„å»ºAIåˆ†æpromptï¼ˆâ­ ä¼˜åŒ–ç‰ˆï¼šè¦æ±‚å¤šå±‚æ¬¡æè¿°ï¼‰\nconst prompt = `ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ±½è½¦åˆ†æå¸ˆï¼Œéœ€è¦æ ¹æ®ä»¥ä¸‹å¯¹è¯ç”Ÿæˆä¸€ä»½è½¦å‹å¯¹æ¯”æŠ¥å‘Šã€‚\n\nã€å¯¹è¯å†…å®¹ã€‘\n${dialogue.join('\\n')}\n\nã€åˆ†æä»»åŠ¡ã€‘\nè¯·åˆ†æå¯¹è¯ä¸­æåˆ°çš„è½¦å‹å’Œå¯¹æ¯”ç»´åº¦ï¼ŒæŒ‰ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼š\n\n\\`\\`\\`json\n{\n  \"vehicles\": [\n    {\"name\": \"è½¦å‹åç§°1\"},\n    {\"name\": \"è½¦å‹åç§°2\"}\n  ],\n  \"dimensions\": [\n    {\n      \"name\": \"å¯¹æ¯”ç»´åº¦ï¼ˆå¦‚ï¼šå¤–è§‚è®¾è®¡ï¼‰\",\n      \"è½¦å‹åç§°1\": {\n        \"label\": \"æ ¸å¿ƒç‰¹ç‚¹ï¼ˆ5-8å­—ï¼‰\",\n        \"desc1\": \"è¯¦ç»†æè¿°ï¼ˆ15-20å­—ï¼‰\",\n        \"desc2\": \"è¡¥å……ä¿¡æ¯æˆ–äº®ç‚¹ï¼ˆ15-20å­—ï¼‰\"\n      },\n      \"è½¦å‹åç§°2\": {\n        \"label\": \"æ ¸å¿ƒç‰¹ç‚¹\",\n        \"desc1\": \"è¯¦ç»†æè¿°\",\n        \"desc2\": \"è¡¥å……ä¿¡æ¯æˆ–äº®ç‚¹\"\n      }\n    }\n  ]\n}\n\\`\\`\\`\n\nã€é‡è¦è§„åˆ™ã€‘\n1. â­ ç¦æ­¢ä½¿ç”¨\"æœªæåŠ\"ã€\"æœªæ˜ç¡®æåŠ\"ç­‰è¯æ±‡\n2. â­ å¦‚æœå¯¹è¯æ²¡æœ‰æ˜ç¡®è®¨è®ºæŸä¸ªç»´åº¦ï¼Œè¯·æ ¹æ®è½¦å‹å®šä½ã€å“ç‰Œç‰¹ç‚¹ã€å¸¸è¯†è¿›è¡Œåˆç†æ¨æ–­\n3. ä¾‹å¦‚ï¼š\n   - è…¾åŠ¿Z9ï¼ˆé«˜ç«¯è½¿è·‘ï¼‰â†’ å¤–è§‚å¯æ¨æ–­\"GTè·‘è½¦é€ å‹ã€è´¯ç©¿å¼ç¯ç»„ã€ä½é£é˜»è®¾è®¡\"\n   - é—®ç•ŒM7ï¼ˆå®¶ç”¨SUVï¼‰â†’ ç©ºé—´å¯æ¨æ–­\"ä¸‰æ’åº§æ¤…å¸ƒå±€ã€çµæ´»å‚¨ç‰©ã€åå¤‡ç®±å……è£•\"\n4. æ¯ä¸ªè¯„ä»·å¿…é¡»æœ‰å®è´¨å†…å®¹ï¼Œä½“ç°ä¸“ä¸šæ€§å’Œç»†èŠ‚\n5. labelè¦ç®€æ´æœ‰åŠ›ï¼Œdesc1/desc2è¦æœ‰å±‚æ¬¡æ„Ÿ\n6. åªè¾“å‡ºJSONï¼Œä¸è¦å…¶ä»–å†…å®¹`;\n\nreturn {\n  json: {\n    dialogueID: dialogueID,\n    title: title,\n    tags: tags,\n    analysisPrompt: prompt\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4496,
        6752
      ],
      "id": "c6c36ed0-8d24-4393-ab3f-fea2c9871ecc",
      "name": "å‡†å¤‡æŠ¥å‘Šåˆ†æprompt"
    },
    {
      "parameters": {
        "jsCode": "// ä»AI Agentçš„è¾“å‡ºä¸­æå–è½¦å‹åˆ—è¡¨\nconst aiOutput = $input.item.json.output || '';\nconst promptData = $('å‡†å¤‡æŠ¥å‘Šåˆ†æprompt').first().json;\n\nlet vehicles = [];\n\ntry {\n  const jsonMatch = aiOutput.match(/```json\\s*([\\s\\S]+?)\\s*```/) || \n                    aiOutput.match(/\\{[\\s\\S]+\\}/);\n  \n  if (jsonMatch) {\n    const jsonStr = jsonMatch[1] || jsonMatch[0];\n    const reportData = JSON.parse(jsonStr);\n    vehicles = (reportData.vehicles || []).map(v => v.name);\n  }\n} catch (e) {\n  console.log('è§£æè½¦å‹å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼');\n  vehicles = ['è½¦å‹1', 'è½¦å‹2'];\n}\n\n// æ ¹æ®å¯¹è¯tagsåˆ¤æ–­éœ€è¦ä»€ä¹ˆç±»å‹çš„å›¾ç‰‡\nconst tags = promptData.tags || '';\nlet filterCategory = 'all';\nlet filterViewType = 'all';\n\nif (tags.includes('å¤–è§‚') || tags.includes('å¤–é¥°')) {\n  filterCategory = 'å¤–è§‚';\n  filterViewType = 'view45';  // é»˜è®¤45åº¦è§’\n} else if (tags.includes('å†…é¥°')) {\n  filterCategory = 'å†…é¥°';\n  filterViewType = 'viewCNSL';  // ä¸­æ§å°è§†è§’\n} else if (tags.includes('ç©ºé—´') || tags.includes('åº§æ¤…')) {\n  filterCategory = 'åº§æ¤…';\n  filterViewType = 'viewDoor';\n}\n\nconsole.log(`æå–åˆ°${vehicles.length}ä¸ªè½¦å‹:`, vehicles);\nconsole.log(`å›¾ç‰‡ç­›é€‰ - åˆ†ç±»: ${filterCategory}, è§†è§’: ${filterViewType}`);\n\nreturn {\n  json: {\n    ...promptData,\n    vehicles: vehicles,\n    filterCategory: filterCategory,\n    filterViewType: filterViewType,\n    aiOutput: aiOutput\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4992,
        6752
      ],
      "id": "edcbf729-04b7-485a-aaf6-b4044a319fee",
      "name": "æå–è½¦å‹åˆ—è¡¨"
    },
    {
      "parameters": {
        "jsCode": "// åˆå¹¶AIåˆ†æç»“æœå’Œå›¾ç‰‡æ•°æ®\nconst extractData = $('æå–è½¦å‹åˆ—è¡¨').first().json;\nconst imageResponse = $input.first().json;\n\nconsole.log('=== æ™ºèƒ½é€‰å›¾åˆå¹¶ ===');\nconsole.log('è½¦å‹æ•°é‡:', extractData.vehicles.length);\n\n// å¤„ç†å›¾ç‰‡APIçš„è¿”å›ï¼ˆå¯èƒ½æ˜¯å•è½¦å‹æˆ–å¤šè½¦å‹ï¼‰\nlet imageResults = [];\nif (imageResponse.results) {\n  // å¤šè½¦å‹è¿”å›\n  imageResults = imageResponse.results;\n} else if (imageResponse.images) {\n  // å•è½¦å‹è¿”å›\n  imageResults = [imageResponse];\n}\n\nconsole.log('å›¾ç‰‡æ•°æ®:', imageResults.length, 'ä¸ªè½¦å‹');\n\n// ä¸ºæ¯ä¸ªè½¦å‹åŒ¹é…å›¾ç‰‡\nconst vehiclesWithImages = extractData.vehicles.map(carName => {\n  // æ‰¾åˆ°åŒ¹é…çš„è½¦å‹å›¾ç‰‡æ•°æ®\n  const matchedData = imageResults.find(img => \n    img.carName && (\n      img.carName.includes(carName) || \n      carName.includes(img.carName) ||\n      img.inputCarName === carName\n    )\n  );\n  \n  if (matchedData && matchedData.images && matchedData.images.length > 0) {\n    // ä¼˜å…ˆä½¿ç”¨ç¬¬ä¸€å¼ å›¾ç‰‡ï¼ˆå·²ç»æŒ‰view_typeç­›é€‰è¿‡äº†ï¼‰\n    const selectedImage = matchedData.images[0];\n    console.log(`âœ… ${carName} åŒ¹é…åˆ°å›¾ç‰‡: ${selectedImage.view_type}`);\n    \n    return {\n      name: carName,\n      imageUrl: selectedImage.url,\n      viewType: selectedImage.view_type,\n      category: selectedImage.category\n    };\n  } else {\n    // æ²¡æœ‰åŒ¹é…åˆ°ï¼Œä½¿ç”¨å ä½å›¾\n    console.log(`âš ï¸ ${carName} æœªåŒ¹é…åˆ°å›¾ç‰‡ï¼Œä½¿ç”¨å ä½å›¾`);\n    return {\n      name: carName,\n      imageUrl: 'https://via.placeholder.com/150x100/667eea/ffffff?text=' + encodeURIComponent(carName),\n      viewType: 'placeholder',\n      category: 'unknown'\n    };\n  }\n});\n\nreturn {\n  json: {\n    dialogueID: extractData.dialogueID,\n    title: extractData.title,\n    tags: extractData.tags,\n    analysisPrompt: extractData.analysisPrompt,\n    aiOutput: extractData.aiOutput,\n    vehicles: vehiclesWithImages,\n    imageStats: {\n      total: vehiclesWithImages.length,\n      matched: vehiclesWithImages.filter(v => v.viewType !== 'placeholder').length,\n      filterCategory: extractData.filterCategory,\n      filterViewType: extractData.filterViewType\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5408,
        6752
      ],
      "id": "b16bd86c-52b2-4d3b-b162-720526fbf837",
      "name": "æ™ºèƒ½é€‰å›¾åˆå¹¶"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://lynn-cafa-system.app.n8n.cloud/webhook/get-car-images",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({\n  carNames: $json.vehicles,\n  filterCategory: $json.filterCategory,\n  filterViewType: $json.filterViewType\n}) }}",
        "options": {
          "timeout": 10000
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5184,
        6752
      ],
      "id": "56222433-e177-4ab2-9fea-7836be56573b",
      "name": "è°ƒç”¨å›¾ç‰‡API (HTTP Request)1"
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json;\nconst convertData = $('è½¬æ¢ä¸ºAIæ ¼å¼').first().json;\nconst isFirstMessage = convertData.isFirstMessage || false;\n\nconsole.log('========== å‡†å¤‡å†™å…¥ Google Sheets ==========');\nconsole.log('dialogueID:', data.dialogueID);\nconsole.log('isFirstMessage:', isFirstMessage);\nconsole.log('å½“å‰ title:', data.title);\n\n// â­ ç­–ç•¥ï¼šåªæœ‰ç¬¬ä¸€æ¬¡å¯¹è¯æ‰å†™å…¥ title\n// ç»§ç»­å¯¹è¯æ—¶ï¼Œä¿æŒ title ä¸ºç©ºï¼ˆGoogle Sheets ä¸ä¼šæ›´æ–°è¯¥å­—æ®µï¼‰\nlet finalTitle;\n\nif (isFirstMessage) {\n  // æ–°å¯¹è¯ï¼Œå†™å…¥ AI ç”Ÿæˆçš„æ ‡é¢˜\n  finalTitle = data.title || 'æœªå‘½åå¯¹è¯';\n  console.log('âœ… æ–°å¯¹è¯ï¼Œå†™å…¥ title:', finalTitle);\n} else {\n  // ç»§ç»­å¯¹è¯ï¼Œä¸ä¼  titleï¼ˆä¿ç•™ Google Sheets åŸå€¼ï¼‰\n  finalTitle = undefined;\n  console.log('â­ï¸ ç»§ç»­å¯¹è¯ï¼Œè·³è¿‡ title æ›´æ–°');\n}\n\nconsole.log('=======================================');\n\nreturn {\n  json: {\n    dialogueID: data.dialogueID,\n    userID: data.userID,\n    title: finalTitle,  // â­ å…³é”®ï¼šç»§ç»­å¯¹è¯æ—¶ä¸º undefined\n    tags: data.tags,\n    conversationHistory: data.conversationHistory,\n    createTime: data.createTime,\n    status: data.status,\n    // åŒæ—¶è¿”å› response ç»™å‰ç«¯\n    response: data.response\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5728,
        6480
      ],
      "id": "be167702-94da-44f9-9bb5-83d4390b299e",
      "name": "å‡†å¤‡å†™å…¥æ•°æ®"
    }
  ],
  "connections": {
    "Router": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "ProcessMessage",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è¯»å–æŠ¥å‘Šå¯¹è¯æ•°æ®",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è¯»å–å¯¹è¯åˆ—è¡¨",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è¯»å–å¯¹è¯è¯¦æƒ…",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ProcessMessage": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­æ˜¯å¦æ–°å¯¹è¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–­æ˜¯å¦æ–°å¯¹è¯": {
      "main": [
        [
          {
            "node": "åˆå§‹åŒ–å¯¹è¯",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "è¿½åŠ ç”¨æˆ·æ¶ˆæ¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GenerateReport": {
      "main": [
        [
          {
            "node": "ç»Ÿä¸€å“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetDialogueList": {
      "main": [
        [
          {
            "node": "ç»Ÿä¸€å“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ ¼å¼åŒ–å“åº”1": {
      "main": [
        [
          {
            "node": "ç»Ÿä¸€å“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆå§‹åŒ–å¯¹è¯": {
      "main": [
        [
          {
            "node": "è½¬æ¢ä¸ºAIæ ¼å¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "å¤„ç†AIå“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "è½¬æ¢ä¸ºAIæ ¼å¼": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¤„ç†AIå“åº”": {
      "main": [
        [
          {
            "node": "å‡†å¤‡å†™å…¥æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ä¿å­˜conversationHistoryåˆ°è¡¨æ ¼": {
      "main": [
        [
          {
            "node": "æ ¼å¼åŒ–å“åº”1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¿½åŠ ç”¨æˆ·æ¶ˆæ¯": {
      "main": [
        [
          {
            "node": "è½¬æ¢ä¸ºAIæ ¼å¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¯»å–å¯¹è¯è¯¦æƒ…": {
      "main": [
        [
          {
            "node": "GetDialogueDetail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetDialogueDetail": {
      "main": [
        [
          {
            "node": "ç»Ÿä¸€å“åº”",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¯»å–å¯¹è¯åˆ—è¡¨": {
      "main": [
        [
          {
            "node": "GetDialogueList",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AIåˆ†æå…¥å£": {
      "main": [
        [
          {
            "node": "Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¯»å–æŠ¥å‘Šå¯¹è¯æ•°æ®": {
      "main": [
        [
          {
            "node": "å‡†å¤‡æŠ¥å‘Šåˆ†æprompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "æå–è½¦å‹åˆ—è¡¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DeepSeek Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡æŠ¥å‘Šåˆ†æprompt": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æå–è½¦å‹åˆ—è¡¨": {
      "main": [
        [
          {
            "node": "è°ƒç”¨å›¾ç‰‡API (HTTP Request)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ™ºèƒ½é€‰å›¾åˆå¹¶": {
      "main": [
        [
          {
            "node": "GenerateReport",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è°ƒç”¨å›¾ç‰‡API (HTTP Request)1": {
      "main": [
        [
          {
            "node": "æ™ºèƒ½é€‰å›¾åˆå¹¶",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å‡†å¤‡å†™å…¥æ•°æ®": {
      "main": [
        [
          {
            "node": "ä¿å­˜conversationHistoryåˆ°è¡¨æ ¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5cb72472896fce0666bc03ef84936c4f09ec11e6b4f95f9aebe3d538947c7935"
  }
}